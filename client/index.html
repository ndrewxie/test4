 <!doctype html>
<html>
    <head>
        <script>
            if (!localStorage.getItem('bypass')) {
                let password = prompt('Use test4.mooink.repl.co instead. If you have a password to supress this warning, enter it here:');
                if (password == '2457') {
                    localStorage.setItem('bypass', 'true');
                }
            }
        </script>
        <title>Rewriter</title>
        <link rel="stylesheet" href="./style.css">
    </head>
    <body>
        <div id="centered">
            <label for="proxurl" id="labelproxurl">URL to re-write: </label>
            <input type="text" id="proxurl" name="proxurl">
            <button id="runprox" onclick="run_prox()">Re-write</button>
        </div>
        <script>
            function run_prox() {
                let to_redirect = new URL(window.location.href);
                
                let target_url = document.getElementById('proxurl').value;
                if (target_url.length <= 0) {
                    alert("Please enter a URL");
                    return;
                }
                try {
                    let temp_url = new URL(target_url);
                }
                catch(e) {
                    alert("Please enter a properly formatted URL. It should start with a protocol (for example, https://), and should contain an extension (for example, .com, .org, .net, .edu)");
                    return;
                }

                let encoded_target = encodeURIComponent(btoa(target_url));
                to_redirect.pathname = '/requestdata';
                to_redirect.searchParams.append('q', encoded_target);
                to_redirect.searchParams.append('baseurl',encoded_target);
                
                window.location.href = to_redirect.href;
            }
        </script>
    </body>
</html>